<style type="text/css">
.Mapbutton {
    display: block;
    width: 115px;
    height: 25px;
    background: #4E9CAF;
    padding: 6px;
    text-align: center;
    border-radius: 5px;
    font-weight: bold;
	}
.Mapbutton:hover{text-decoration:none;}
</style>

<span>Please Select Product</span><div id="divProduct"></div><br/>
<span id="spanLabelVersion" style="display:none;">Please Select LabelVersion</span><div id="divLabelVersion"></div><br/>
<div><a class="Mapbutton" onclick = "openSolution();">Get MAP</a></div><br/>
<div id="ColorStatus" style="display:none;">
  <span style="background-color: green; color: green; padding: 0px 3px; border: 1px solid black;">green</span> Registered
  <span style="background-color: red; color: red; padding: 0px 9px; border: 1px solid black;">red</span> Pending Submission
  <span style="background-color: blue; color: blue; border: 1px solid black; padding: 0px 6px;">blue</span> Submitted/Pending Registration
  <span style="background-color: white; color: white; border: 1px solid black; padding: 0px 4px;">white</span> Product not registered in this state 
  <span style="background-color: yellow; color: white; border: 1px solid black; padding: 0px 4px;">yellow</span> Discontinued
</div>
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.10.1.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript" src="https://www.google.com/jsapi?key=AIzaSyCfzuw6FKPsc50rXfYmLh9qNKMACYWsuhA"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCfzuw6FKPsc50rXfYmLh9qNKMACYWsuhA"></script>
<div id='visualization' style="width: 700px; height: 433px;"></div>
<div id ="itemInfo" style="display:none;margin-left: 316px;margin-top: -32px;">
<span id="prdname"></span><br/>
<span id="EPARegNo"></span><br/>
<span id="lblversion"></span><br/>
<span id="Date"></span>
</div>
<script>
$(document).ready(function () {

productsDrpDownBind();

});

var ProductName='';
var LabelVersion='';
var EPA_Reg ='';
var date ='';
var SharepointsiteUrl = 'https://upllimited.sharepoint.com/sites/ALS/RD/Reg/US_State_Reg';

function productsDrpDownBind() {

var listName = "ALSNAProducts";

var url = _spPageContextInfo.webAbsoluteUrl;

getListItems(listName, url, function (data) {

var items = data.d.results;
var inputElement = '<select id="drpProducts" onchange="retrieveProductListItems()"> <option  value="">Select</option>';

for (var i = 0; i < items.length; i++) {

var itemId = items[i].Products.Title,

itemVal = items[i].Products["Title"];

inputElement += '<option value="' + itemId + '"selected>' + itemId + '</option>';

}

inputElement += '</select>';

$('#divProduct').append(inputElement);

$("#drpProducts").each(function () {

$('option', this).each(function () {

if ($(this).text() == 'Select') {

$(this).attr('selected', 'selected')

};

});

});

}, function (data) {

alert("Ooops, an error occured. Please try again");

});

}

function getListItems(listName, siteurl, success, failure) {

$.ajax({

url: siteurl + "/_api/web/lists/getbytitle('" + listName + "')/items?$select=fpvo,Products/Title&$expand=Products&$orderby=Products asc&$top=400",

method: "GET",

headers: { "Accept": "application/json; odata=verbose" },

success: function (data) {

success(data);

},

error: function (data) {

failure(data);

}

});

}

function labelDrpDownBind(){
 
 var listName = "ALSNA";
//alert(listName);
var url = _spPageContextInfo.webAbsoluteUrl;

getLabelVersionsListItems(listName, url, function (data) {
document.getElementById("spanLabelVersion").style.display= "inline";
var items = data.d.results;
var inputElement = '<select id="drpLabelVersion" onchange="retrieveLabelVersionListItems()"> <option  value="">Select</option>';


for (var i = 0; i < items.length; i++) {

var itemId = items[i].LabelVersion,

itemVal = items[i].LabelVersion;

inputElement += '<option value="' + itemId + '"selected>' + itemId + '</option>';

}

inputElement += '</select>';

$('#divLabelVersion').append(inputElement);


$("#drpLabelVersion").each(function () {

$('option', this).each(function () {

if ($(this).text() == 'Select') {

$(this).attr('selected', 'selected')

};

});

});


}, function (data) {

alert("Ooops, an error occured. Please try again");

});
 
}

 function getLabelVersionsListItems(listName, siteurl, success, failure) {

 var productValue = ProductName;
 //alert("productValue : "+productValue);
 
$.ajax({

//url: siteurl + "/_api/web/lists/getbytitle('" + listName + "')/items?$orderby=LabelVersion desc",
//url: siteurl + "/_api/web/lists/getbytitle('" + listName + "')/items?$select=RefProduct/Product&$expand=RefProduct&$filter=RefProduct/Product eq '"+ProductName+"'",
url: siteurl + "/_api/web/lists/getbytitle('" + listName + "')/items?$select=LabelVersion,Products/Title&$expand=Products&$filter=Products/Title eq '"+ProductName+"'",

method: "GET",

headers: { "Accept": "application/json; odata=verbose" },

success: function (data) {

success(data);

},

error: function (data) {

failure(data);

}

});

}

function retrieveProductListItems() {

$("#divLabelVersion").empty();
var e = document.getElementById("drpProducts");
	ProductName = e.options[e.selectedIndex].text;
	//alert(ProductName);
labelDrpDownBind();
}
function retrieveLabelVersionListItems() {

var e = document.getElementById("drpLabelVersion");
	LabelVersion = e.options[e.selectedIndex].text;
	//alert(LabelVersion);
}

function openSolution(){
//alert("Hello");
google.charts.load('current', {'packages': ['geochart']});
google.charts.setOnLoadCallback(drawVisualization);
}
function drawVisualization() {
	//alert("drawVisualization");
	//alert("ProductName :"+ProductName);
	//document.getElementById('prdname').appendChild(ProductName);
	document.getElementById("prdname").innerHTML = "ProductName : "+ProductName;
	//alert("LabelVersion :"+LabelVersion);
	document.getElementById("lblversion").innerHTML = "LabelVersion : "+LabelVersion;
	var clientContext = new SP.ClientContext(SharepointsiteUrl);
    var oList = clientContext.get_web().get_lists().getByTitle('ALSNA');
	var camlQuery = new SP.CamlQuery();
	camlQuery.set_viewXml('<View><Query><Where><And><Eq><FieldRef Name="LabelVersion"/><Value Type="Text">'+LabelVersion+'</Value></Eq><Eq><FieldRef Name="Products"/><Value Type="Lookup">'+ProductName+'</Value></Eq></And></Where></Query></View>'); 
    this.collListItem = oList.getItems(camlQuery);
    clientContext.load(collListItem);
	clientContext.executeQueryAsync(Function.createDelegate(this, this.onQuerySucceeded), Function.createDelegate(this, this.onQueryFailed));        
    }
function onQuerySucceeded(sender, args) {	

	var ALABAMAInfo =''; var ALASKAInfo  =''; var ARIZONAInfo  =''; var ARKANSASInfo  =''; var CALIFORNIAInfo =''; var COLORADOInfo =''; var CONNECTICUTInfo =''; var DELAWAREInfo =''; var FLORIDAInfo =''; var GEORGIAInfo =''; var HAWAIIInfo =''; var IDAHOInfo ='';
	var ILLINOISInfo =''; var INDIANAInfo =''; var IOWAInfo =''; var KANSASInfo =''; var KENTUCKYInfo =''; var LOUISIANAInfo =''; var MAINEInfo =''; var MARYLANDInfo =''; var MASSACHUSETTSInfo =''; var MICHIGANInfo =''; var MINNESOTAInfo =''; var MISSISSIPPIInfo =''; var MISSOURIInfo ='';
	var MONTANAInfo =''; var NEBRASKAInfo =''; var NEVADAInfo =''; var NEW_HAMPSHIREInfo =''; var NEW_JERSEYInfo =''; var NEW_MEXICOInfo =''; var NEW_YORKInfo =''; var NORTH_CAROLINAInfo =''; var NORTH_DAKOTAInfo =''; var OHIOInfo =''; var OKLAHOMAInfo =''; var OREGONInfo ='';
	var PENNSYLVANIAInfo =''; var RHODE_ISLANDInfo =''; var SOUTH_CAROLINAInfo =''; var SOUTH_DAKOTAInfo =''; var TENNESSEEInfo =''; var TEXASInfo =''; var UTAHInfo =''; var VERMONTInfo =''; var VIRGINAInfo =''; var WASHINGTONInfo =''; var WEST_VIRGINAInfo =''; var WISCONSINInfo =''; var WYOMINGInfo ='';
	
	//var ID ='';
	//var ActiveStates = '';
	
    var listItemEnumerator = collListItem.getEnumerator();
	var FlagStatus1 = []; 
   while (listItemEnumerator.moveNext()) {
        var oListItem = listItemEnumerator.get_current();
		ID = oListItem.get_id();
		EPA_Reg = oListItem.get_item('EPA_x0020_ID');
		var EPA_ID = EPA_Reg.get_lookupValue();
		document.getElementById("EPARegNo").innerHTML = "EPA Reg No : "+EPA_ID;
				
		date = oListItem.get_item('Date_x0020_Artwork_x0020_Rec_x00');
		document.getElementById("Date").innerHTML = "Date : "+date;
		
		ALASKAInfo  = oListItem.get_item('Alabama');
		FlagStatus1.push(ALASKAInfo);
        ALABAMAInfo = oListItem.get_item('Alaska');
		FlagStatus1.push(ALABAMAInfo);		
		ARIZONAInfo  = oListItem.get_item('Arizona');
		FlagStatus1.push(ARIZONAInfo);		
		ARKANSASInfo  = oListItem.get_item('Arkansas');
		FlagStatus1.push(ARKANSASInfo);
		CALIFORNIAInfo = oListItem.get_item('California');
		FlagStatus1.push(CALIFORNIAInfo);
		COLORADOInfo = oListItem.get_item('Colorado');
		FlagStatus1.push(COLORADOInfo);
		CONNECTICUTInfo = oListItem.get_item('Connecticut');
		FlagStatus1.push(CONNECTICUTInfo);
		DELAWAREInfo = oListItem.get_item('Delaware');
		FlagStatus1.push(DELAWAREInfo);
		FLORIDAInfo = oListItem.get_item('Florida');
		FlagStatus1.push(FLORIDAInfo);
		GEORGIAInfo = oListItem.get_item('Georgia');
		FlagStatus1.push(GEORGIAInfo);		
		
		HAWAIIInfo = oListItem.get_item('Hawaii');
		FlagStatus1.push(HAWAIIInfo);
		IOWAInfo = oListItem.get_item('Iowa');
		FlagStatus1.push(IOWAInfo);
		IDAHOInfo = oListItem.get_item('Idaho');
		FlagStatus1.push(IDAHOInfo);
		ILLINOISInfo = oListItem.get_item('Illinois');
		FlagStatus1.push(ILLINOISInfo);
		INDIANAInfo = oListItem.get_item('Indiana');
		FlagStatus1.push(INDIANAInfo);
		KANSASInfo = oListItem.get_item('Kansas');
		FlagStatus1.push(KANSASInfo);
		KENTUCKYInfo = oListItem.get_item('Kentucky');
		FlagStatus1.push(KENTUCKYInfo);
		LOUISIANAInfo = oListItem.get_item('Louisiana');
		FlagStatus1.push(LOUISIANAInfo);
		MAINEInfo = oListItem.get_item('Maine');
		FlagStatus1.push(MAINEInfo);
		MARYLANDInfo = oListItem.get_item('Maryland');
		FlagStatus1.push(MARYLANDInfo);
		MASSACHUSETTSInfo = oListItem.get_item('Massachusetts');
		FlagStatus1.push(MASSACHUSETTSInfo);
		
		
				
		
		MICHIGANInfo = oListItem.get_item('Michigan');
		FlagStatus1.push(MICHIGANInfo);
		MINNESOTAInfo = oListItem.get_item('Minnesota');
		FlagStatus1.push(MINNESOTAInfo);
		MISSISSIPPIInfo = oListItem.get_item('Mississippi');
		FlagStatus1.push(MISSISSIPPIInfo);
		MISSOURIInfo = oListItem.get_item('Missouri');
		FlagStatus1.push(MISSOURIInfo);
		
		MONTANAInfo = oListItem.get_item('Montana');
		FlagStatus1.push(MONTANAInfo);
		NORTH_CAROLINAInfo = oListItem.get_item('North_x0020_Carolina');
		FlagStatus1.push(NORTH_CAROLINAInfo);
		NORTH_DAKOTAInfo = oListItem.get_item('North_x0020_Dakota');
		FlagStatus1.push(NORTH_DAKOTAInfo);
		NEBRASKAInfo = oListItem.get_item('Nebraska');
		FlagStatus1.push(NEBRASKAInfo);
		NEW_HAMPSHIREInfo = oListItem.get_item('New_x0020_Hampshire');
		FlagStatus1.push(NEW_HAMPSHIREInfo);
		NEW_JERSEYInfo = oListItem.get_item('New_x0020_Jersey');
		FlagStatus1.push(NEW_JERSEYInfo);
		
		
		
		NEW_MEXICOInfo = oListItem.get_item('New_x0020_Mexico');
		FlagStatus1.push(NEW_MEXICOInfo);
		NEVADAInfo = oListItem.get_item('Nevada');
		FlagStatus1.push(NEVADAInfo);
		NEW_YORKInfo = oListItem.get_item('New_x0020_York');
		FlagStatus1.push(NEW_YORKInfo);
		OHIOInfo = oListItem.get_item('Ohio');
		FlagStatus1.push(OHIOInfo);
		OKLAHOMAInfo = oListItem.get_item('Oklahoma');
		FlagStatus1.push(OKLAHOMAInfo);
		OREGONInfo = oListItem.get_item('Oregon');
		FlagStatus1.push(OREGONInfo);
		PENNSYLVANIAInfo = oListItem.get_item('Pennsylvania');
		FlagStatus1.push(PENNSYLVANIAInfo);
		RHODE_ISLANDInfo = oListItem.get_item('Rhode_x0020_Island');
		FlagStatus1.push(RHODE_ISLANDInfo);
		SOUTH_CAROLINAInfo = oListItem.get_item('South_x0020_Carolina');
		FlagStatus1.push(SOUTH_CAROLINAInfo);
		SOUTH_DAKOTAInfo = oListItem.get_item('South_x0020_Dakota');
		FlagStatus1.push(SOUTH_DAKOTAInfo);
		
		
		TENNESSEEInfo = oListItem.get_item('Tennessee');
		FlagStatus1.push(TENNESSEEInfo);
		TEXASInfo = oListItem.get_item('Texas');
		FlagStatus1.push(TEXASInfo);
		UTAHInfo = oListItem.get_item('Utah');
		FlagStatus1.push(UTAHInfo);
		VIRGINAInfo = oListItem.get_item('Virginia');
		FlagStatus1.push(VIRGINAInfo);
		VERMONTInfo = oListItem.get_item('Vermont');
		FlagStatus1.push(VERMONTInfo);
		WASHINGTONInfo = oListItem.get_item('Washington');
		FlagStatus1.push(WASHINGTONInfo);
		WISCONSINInfo = oListItem.get_item('Wisconsin');
		FlagStatus1.push(WISCONSINInfo);
		WEST_VIRGINAInfo = oListItem.get_item('West_x0020_Virginia');
		FlagStatus1.push(WEST_VIRGINAInfo);
		WYOMINGInfo = oListItem.get_item('Wyoming');
		FlagStatus1.push(WYOMINGInfo);
		
		}
	    //alert("FlagStatus1 values : "+FlagStatus1);	
		var Country = [];
		var CountryCode = [];
		var value =[];
		
		var data = new google.visualization.DataTable();
		data.addColumn('string', 'Country');
		data.addColumn('number', 'Value'); 
 
		var ivalue = new Array();
		var CountryCode = ['US-AL','US-AK','US-AR','US-AZ','US-CA','US-CO','US-CT','US-DE','US-FL','US-GA','US-HI','US-IA','US-ID','US-IL','US-IN','US-KS','US-KY','US-LA','US-MA','US-MD','US-ME','US-MI','US-MN','US-MO','US-MS','US-MT','US-NC','US-ND','US-NE','US-NH','US-NJ','US-NM','US-NV','US-NY','US-OH','US-OK','US-OR','US-PA','US-RI','US-SC','US-SD','US-TN','US-TX','US-UT','US-VA','US-VT','US-WA','US-WI','US-WV','US-WY'];
		var Country = ['Alabama','Alaska','Arizona','Arkansas','California','Colorado','Connecticut','Delaware','Florida','Georgia','Hawaii','Iowa','Idaho','Illinois','Indiana','Kansas','Kentucky','Louisiana','Massachusetts','Maryland','Maine','Michigan','Minnesota','Missouri','Mississippi','Montana','North Carolina','North Dakota','Nebraska','New Hampshire','New Jersey','New Mexico','Nevada','New York','Ohio','Oklahoma','Oregon','Pennsylvania','Rhode Island','South Carolina','South Dakota','Tennessee','Texas','Utah','Virginia','Vermont','Washington','Wisconsin','West Virginia','Wyoming'];
		var value = [0,1, 2, 3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49];
		var i;
		var colorValues = [];
		var length = value.length;
		for(i=0; i<=length-1 ; i++)
		{
		data.addRows([[{v:CountryCode[i],f:Country[i]},value[i]]]);
		ivalue[CountryCode[i]] = Country[i];
		colorValues.push(i);
		FlagStatus1.push(i);
		
		}
		//alert("colorValues values :"+colorValues);
		//alert("FlagStatus1 values :"+FlagStatus1);
		var colorValues = [0,1, 2, 3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49];
		var i;
		var colorNames = [];
		
		FlagStatus1.forEach(function(value) {
		if (value == "Registered") {
		 //alert("colorNames : green");
		  colorNames.push('green');
		} 
		if (value == "Pending Submission") {
		//alert("colorNames : red");
		 colorNames.push('red');
		}
		if (value == "Submitted/Pending Registration") {
		//alert("colorNames : blue");
		  colorNames.push('blue');
		}  
		if(value == "Product Not Registered in this State"){
		//alert("colorNames : white");
		colorNames.push('white');
		}
		if(value == "Discontinued"){
		//alert("colorNames : yellow");
		colorNames.push('yellow');
		}
			});
		
		//alert("ColorNames:"+colorNames+","+"ColorValues:"+colorValues);
	var options = {
		backgroundColor: {fill:'#FFFFFF',stroke:'#FFFFFF' ,strokeWidth:0 },
		colorAxis:  {
		colors: colorNames,
		values: colorValues
		},
		legend: {textStyle: {color: 'black', fontSize: 10}},	
		datalessRegionColor: '#f5f5f5',
	    displayMode: 'regions', 
	    enableRegionInteractivity: 'true', 
		resolution: 'provinces',
		sizeAxis: {minValue: 1, maxValue:1,minSize:10,  maxSize: 10},
		region:'US',
		keepAspectRatio: true,
		width:600,
	    height:400,
		tooltip: {textStyle: {color: '#444444'}, trigger:'hover'}	
		 };
	var chart = new google.visualization.GeoChart(document.getElementById('visualization'));
	google.visualization.events.addListener(chart, 'select', function() {
	var selection = chart.getSelection();
	if (selection.length == 1) {
	var selectedRow = selection[0].row;
	var selectedRegion = data.getValue(selectedRow, 0);
	if(ivalue[selectedRegion] != '') { 
	//alert(ivalue[selectedRegion]);
	}
		}
		});
	chart.draw(data, options);
	document.getElementById("itemInfo").style.display= "block";
	document.getElementById("ColorStatus").style.display= "block";
	}
 
 function onQueryFailed(sender, args) {

    alert('Request failed. ' + args.get_message() + '\n' + args.get_stackTrace());
} 
</script>